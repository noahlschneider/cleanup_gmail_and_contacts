{"files":[{"id":"b43ff819-995e-4b2f-a0f0-913177e3d196","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Chicago\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"198d09c0-2ace-490b-948f-7d0dfe4bce5f","name":"CleanupOldEmails","type":"server_js","source":"/**\n * Moves old emails matching criteria to trash.\n * Safe to run multiple times (if times out); can be triggered daily.\n * \n * Criteria:\n * - Promotions/Social/Forums: older than 2 years\n * - Everything else: older than 5 years\n * - Excludes: starred, snoozed, or user-labeled emails\n**/\n\nfunction trashOldEmails() {\n\n  // Configuration object containing all adjustable settings\n  const CONFIG \u003d {\n    promoSocialForumMaxAge: \u00272y\u0027, // Max age for promotional/social/forum emails\n    defaultMaxAge: \u00275y\u0027,         // Max age for all other emails\n    batchSize: 100,              // Number of threads to process per batch (max 100 per GmailApp.moveThreadsToTrash resetriction)\n  }\n\n  // Build the Gmail search query\n  const searchQuery \u003d `(((category:promotions OR category:social OR category:forums) AND older_than:${CONFIG.promoSocialForumMaxAge}) OR older_than:${CONFIG.defaultMaxAge}) AND -is:starred -has:userlabels AND -in:snoozed`;\n\n  // Log search query\n  Logger.log(`Search query: ${searchQuery}`);\n\n  // Counter for total threads moved to trash across all batches\n  let threadsTrashed \u003d 0;\n\n  // Counter for logging which batch we\u0027re processing\n  let batchNumber \u003d 0;\n\n  // Variable to hold the current batch of email threads\n  let threads;\n\n  // Wrap everything in try-catch to handle Gmail API errors gracefully\n  try {\n\n    // Loop until we get fewer threads than batch size (meaning we\u0027ve processed all)\n    do {\n      \n      // Search Gmail for threads matching our query, starting at index 0, returing up to batchSize threads at a time\n      threads \u003d GmailApp.search(searchQuery, 0, CONFIG.batchSize);\n\n      // If threads found\n      if (threads.length \u003e 0) {\n\n        // Move all threads in this batch to the trash\n        GmailApp.moveThreadsToTrash(threads);\n\n        // Add this batch\u0027s count to our running total\n        threadsTrashed +\u003d threads.length;\n\n        // Log progress for this batch\n        Logger.log(`Batch ${batchNumber}: ${threads.length} threads trashed`);\n      }\n\n      // Increment batch counter for next iteration\n      batchNumber++;\n\n    } while (threads.length \u003d\u003d\u003d CONFIG.batchSize);\n\n    // Log final summary when complete\n    Logger.log(`Complete: ${threadsTrashed} threads moved to trash.`);\n\n  // Catch any errors that occur during execution\n  } catch (error) {\n    \n    // Log error with context about how much was completed before failure\n    Logger.log(`Error after trashing ${threadsTrashed} threads: ${error.message}`);\n\n    // Re-throw the error so any trigger knows the script failed\n    throw error;\n  }\n}"},{"id":"ff69db8b-179c-44e2-b783-d8efc38a0043","name":"CleanupOtherContacts","type":"server_js","source":"/**\n * Identifies \"other contacts\" that have no email threads so you can delete them.\n * \n * Usage:\n * 1. Export contacts from https://contacts.google.com/other as CSV\n * 2. Extract email addresses and paste into emailsToCheck array\n * 3. Run this script to find which contacts have no email history\n * 4. Review and delete unused contacts from Google Contacts (this unforunatley not be automated)\n**/\n\nfunction checkOtherContactsToDelete() {\n\n  // Configuration object containing all adjustable settings\n  const CONFIG \u003d {\n    \n    // List of emails to check - get from Google Contacts CSV export\n    emailsToCheck: [\n      \u0027abc@123.com\u0027,\n      /// ...\n    ]\n  };\n\n  // Array to hold email addresses with no threads found\n  let unusedEmails \u003d [];\n\n  // Array to hold email addresses that have threads\n  let usedEmails \u003d [];\n\n  // Wrap everything in try-catch to handle Gmail API errors gracefully\n  try {\n\n    // Loop over each email address to check\n    for (const email of CONFIG.emailsToCheck) {\n\n      // Build the search query to find emails from or to this address\n      const searchQuery \u003d `from:${email} OR to:${email}`;\n\n      // Search for at least one thread (we only need to know if any exist)\n      const hasThreads \u003d GmailApp.search(searchQuery, 0, 1).length \u003e 0;\n\n      // Sort email into appropriate array based on whether threads exist\n      if (hasThreads) {\n        usedEmails.push(email);\n      } else {\n        unusedEmails.push(email);\n      }\n    }\n\n    // Log summary counts\n    Logger.log(`Complete: ${unusedEmails.length} unused, ${usedEmails.length} used`);\n\n    // If unused email addresses were found, log them for deletion\n    if (unusedEmails.length \u003e 0) {\n\n      // Build formatted list of emails to delete\n      const deleteList \u003d unusedEmails.join(\u0027\\n\u0027);\n\n      // Log the list of emails that can be deleted\n      Logger.log(`Delete the following:\\n${deleteList}`);\n    }\n\n  // Catch any errors that occur during execution\n  } catch (error) {\n\n    // Log error with context about progress before failure\n    Logger.log(`Error after checking ${usedEmails.length + unusedEmails.length} emails: ${error.message}`);\n\n    // Re-throw the error so any trigger knows the script failed\n    throw error;\n  }\n}"}]}